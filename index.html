<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG F1 - Bahrain Telemetry</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f0ff;
            --secondary: #ff00aa;
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --text: #fff;
            --text-dim: #888;
            --success: #00ff88;
            --warning: #ffaa00;
            --danger: #ff4444;
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            background: var(--bg-dark);
            font-family: 'Roboto', sans-serif;
            color: var(--text);
            min-height: 100vh;
        }
        
        header {
            background: linear-gradient(135deg, rgba(0,240,255,0.1), rgba(255,0,170,0.1));
            padding: 20px;
            border-bottom: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 36px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: var(--text-dim);
            font-size: 14px;
            margin-top: 5px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        select, button {
            background: var(--bg-card);
            color: var(--text);
            border: 1px solid #333;
            padding: 10px 15px;
            border-radius: 8px;
            font-family: 'Orbitron', sans-serif;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        select:hover, button:hover {
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0,240,255,0.3);
        }
        
        button.active {
            background: var(--primary);
            color: #000;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }
        
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 1fr;
            }
        }
        
        .track-container {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }
        
        .track-svg {
            width: 100%;
            height: auto;
            background: #0a0a0f;
            border-radius: 8px;
        }
        
        .info-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #222;
        }
        
        .card h3 {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--text-dim);
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        
        .driver-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .driver-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: bold;
        }
        
        .driver-team {
            color: var(--text-dim);
            font-size: 12px;
        }
        
        .lap-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            color: var(--primary);
            text-align: center;
            margin: 15px 0;
        }
        
        .sectors {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        .sector {
            background: #1a1a25;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }
        
        .sector-label {
            font-size: 10px;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .sector-time {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--text);
        }
        
        .telemetry-charts {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .chart {
            height: 80px;
            background: #0a0a0f;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .chart canvas {
            width: 100%;
            height: 100%;
        }
        
        .chart-label {
            position: absolute;
            top: 5px;
            left: 10px;
            font-size: 10px;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .chart-value {
            position: absolute;
            top: 5px;
            right: 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
        }
        
        .micro-sectors {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 2px;
        }
        
        .micro-sector {
            height: 30px;
            background: #1a1a25;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-family: 'Orbitron', sans-serif;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .micro-sector:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .micro-sector.best { background: var(--success); color: #000; }
        .micro-sector.fast { background: var(--primary); color: #000; }
        .micro-sector.slow { background: var(--danger); }
        .micro-sector.normal { background: #333; }
        
        .driver-list {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .driver-btn {
            padding: 10px;
            text-align: left;
            font-size: 12px;
        }
        
        .driver-btn .name {
            font-family: 'Orbitron', sans-serif;
            font-weight: bold;
        }
        
        .driver-btn .time {
            color: var(--primary);
            font-size: 11px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-dim);
        }
        
        .legend {
            display: flex;
            gap: 15px;
            font-size: 10px;
            color: var(--text-dim);
            margin-top: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        
        /* Tooltip */
        .tooltip {
            position: absolute;
            background: #1a1a25;
            border: 1px solid var(--primary);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            z-index: 100;
            display: none;
        }
        
        .tooltip.show { display: block; }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>SG<span style="color:#00f0ff">F1</span></h1>
            <div class="subtitle">BAHRAIN INTERNATIONAL CIRCUIT • PRE-SEASON 2026</div>
        </div>
        <div class="controls">
            <select id="sessionSelect">
                <option value="test2-s3">Test 2 - Session 3 (Best)</option>
                <option value="test2-s2">Test 2 - Session 2</option>
                <option value="test2-s1">Test 2 - Session 1</option>
                <option value="test1-s3">Test 1 - Session 3</option>
            </select>
            <button id="compareBtn">Compare</button>
        </div>
    </header>
    
    <div class="main-container">
        <div class="track-container">
            <svg class="track-svg" viewBox="-600 -3600 8200 12000" id="trackSvg">
                <!-- Background -->
                <rect x="-600" y="-3600" width="8200" height="12000" fill="#0a0a0f"/>
                
                <!-- Grid -->
                <g stroke="#151520" stroke-width="2">
                    <line x1="-600" y1="0" x2="7600" y2="0"/>
                    <line x1="-600" y1="2500" x2="7600" y2="2500"/>
                    <line x1="-600" y1="5000" x2="7600" y2="5000"/>
                    <line x1="-600" y1="7500" x2="7600" y2="7500"/>
                    <line x1="0" y1="-3600" x2="0" y2="8400"/>
                    <line x1="2000" y1="-3600" x2="2000" y2="8400"/>
                    <line x1="4000" y1="-3600" x2="4000" y2="8400"/>
                    <line x1="6000" y1="-3600" x2="6000" y2="8400"/>
                </g>
                
                <!-- Track base -->
                <path id="trackBase" fill="none" stroke="#222" stroke-width="80" stroke-linecap="round" d=""/>
                
                <!-- Racing line -->
                <path id="racingLine" fill="none" stroke="#00f0ff" stroke-width="3" stroke-dasharray="20,15" opacity="0.6" d=""/>
                
                <!-- Telemetry path -->
                <path id="telemetryPath" fill="none" stroke="#ff00aa" stroke-width="4" d=""/>
                
                <!-- Current position marker -->
                <circle id="carMarker" r="20" fill="#ff00aa" stroke="#fff" stroke-width="3" style="display:none"/>
            </svg>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background:#222"></div>
                    <span>Pista</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background:#00f0ff"></div>
                    <span>Linha de Corrida</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background:#ff00aa"></div>
                    <span>Telemetria</span>
                </div>
            </div>
        </div>
        
        <div class="info-panel">
            <div class="card">
                <h3>Driver</h3>
                <div class="driver-info">
                    <div>
                        <div class="driver-name" id="driverName">NOR</div>
                        <div class="driver-team" id="driverTeam">McLaren</div>
                    </div>
                    <div id="driverCompound" style="background:#00ff88;padding:5px 10px;border-radius:5px;color:#000;font-size:12px;font-weight:bold;">SOFT</div>
                </div>
                <div class="lap-time" id="lapTime">1:32.456</div>
                
                <div class="sectors">
                    <div class="sector">
                        <div class="sector-label">Setor 1</div>
                        <div class="sector-time" id="sector1">31.234</div>
                    </div>
                    <div class="sector">
                        <div class="sector-label">Setor 2</div>
                        <div class="sector-time" id="sector2">31.567</div>
                    </div>
                    <div class="sector">
                        <div class="sector-label">Setor 3</div>
                        <div class="sector-time" id="sector3">29.655</div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>Micro-Setores (Vel. Média km/h)</h3>
                <div class="micro-sectors" id="microSectors">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <div class="card">
                <h3>Telemetria</h3>
                <div class="telemetry-charts">
                    <div class="chart">
                        <span class="chart-label">Speed</span>
                        <span class="chart-value" id="speedValue">0 km/h</span>
                        <canvas id="speedChart"></canvas>
                    </div>
                    <div class="chart">
                        <span class="chart-label">RPM</span>
                        <span class="chart-value" id="rpmValue">0</span>
                        <canvas id="rpmChart"></canvas>
                    </div>
                    <div class="chart">
                        <span class="chart-label">Throttle / Brake</span>
                        <canvas id="throttleChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <h3>All Drivers</h3>
                <div class="driver-list" id="driverList">
                    <!-- Generated by JS -->
                </div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // Track path data (coordenadas reais do Bahrain)
        const trackPath = `M -375 1344 L -367 1551 L -356 1793 L -341 2154 L -333 2371 L -318 2713 L -296 3177 L -283 3473 L -265 3973 L -256 4212 L -241 4628 L -232 4890 L -226 5079 L -209 5588 L -199 5893 L -183 6433 L -174 6607 L -165 6767 L -159 7024 L -154 7534 L -150 7863 L -147 8225 L -141 8583 L -138 8863 L -136 9086 L -133 9270 L -132 9503 L -122 9755 L -121 9823 L -119 10065 L -106 10387 L -89 10527 L -88 10607 L -65 10834 L -56 10942 L -30 11102 L -5 11223 L 6 11295 L 28 11444 L 44 11595 L 115 12109 L 117 12217 L 158 12463 L 180 12600 L 196 12921 L 234 13447 L 235 13537 L 259 13738 L 263 13821 L 288 14031 L 300 14165 L 319 14319 L 330 14427 L 348 14574 L 375 14783 L 398 14971 L 426 15222 L 449 15474 L 474 15704 L 476 15795 L 499 15983 L 523 16210 L 548 16516 L 595 16904 L 607 16992 L 693 17685 L 715 17831 L 795 18451 L 811 18576 L 876 19042 L 881 19083 L 954 19626 L 1074 20443 L 1090 20545 L 1208 21321 L 1243 21560 L 1337 22177 L 1350 22268 L 1443 22869 L 1585 23848 L 1602 23966 L 1655 24322 L 1759 24954 L 1820 25366 L 1923 25997 L 1994 26471 L 2064 26911 L 2088 27067 L 2238 27985 L 2257 28158 L 2380 28953 L 2386 28994 L 2479 29603 L 2580 30228 L 2637 30619 L 2706 31086 L 2807 31766 L 2860 32083 L 3109 33876 L 3131 34043 L 3201 34506 L 3270 34970 L 3399 35883 L 3420 36035 L 3511 36662 L 3559 36998 L 3622 37449 L 3643 37601 L 3792 38689 L 3813 38857 L 3935 39819 L 3956 39997 L 4072 40855 L 4078 40902 L 4217 41882 L 4400 42767 L 4548 43653 L 4555 43699 L 4683 44455 L 4791 45091 L 4866 45649 L 4985 46631 L 5112 47595 L 5158 47925 L 5251 48572 L 5502 50399 L 5571 50961 L 5658 51595 L 5771 52460 L 5868 53190 L 6027 54423 L 6135 55316 L 6156 55479 L 6367 57092 L 6500 58200 L 6508 58261 L 6620 59157 L 6756 60239 L 6802 60574 L 6946 61661 L 7008 62138 L 7048 62474 L 7081 62710 L 7196 63664 L 7223 63854 L 7242 63995 L 7337 64736 L 7368 64981 L 7387 65148 L 7432 65489 L 7437 65523 L 7464 65724 L 7476 65809 L 7495 65960 L 7498 65986 L 7499 65990 L 7496 65971 L 7483 65870 L 7473 65800 L 7446 65587 L 7420 65408 L 7409 65328 L 7375 65102 L 7373 65085 L 7333 64820 L 7319 64734 L 7242 64208 L 7192 63873 L 7150 63575 L 7122 63377 L 7066 62979 L 6994 62513 L 6984 62447 L 6970 62342 L 6915 61967 L 6832 61438 L 6771 60999 L 6701 60526 L 6664 60284 L 6608 59915 L 6595 59816 L 6462 58894 L 6412 58568 L 6384 58382 L 6286 57783 L 6257 57591 L 6160 56993 L 6155 56958 L 6104 56623 L 6042 56193 L 6015 56015 L 5924 55452 L 5917 55400 L 5859 54999 L 5783 54477 L 5701 53929 L 5684 53826 L 5641 53503 L 5604 53258 L 5470 52365 L 5438 52146 L 5281 51106 L 5253 50932 L 5227 50780 L 5133 50362 L 5089 50080 L 4967 49338 L 4907 48945 L 4883 48793 L 4844 48525 L 4816 48336 L 4586 46676 L 4580 46636 L 4517 46199 L 4457 45811 L 4295 44710 L 4275 44578 L 4176 43978 L 4106 43514 L 4070 43254 L 4043 43067 L 3973 42598 L 3968 42562 L 3857 41749 L 3852 41714 L 3718 40762 L 3704 40667 L 3628 40196 L 3572 39819 L 3563 39755 L 3497 39294 L 3447 38962 L 3407 38678 L 3309 38114 L 3299 38049 L 3246 37692 L 3203 37484 L 3173 37289 L 3150 37108 L 3102 36784 L 3067 36560 L 2990 36054 L 2977 35972 L 2928 35642 L 2921 35597 L 2872 35267 L 2833 35034 L 2793 34778 L 2741 34472 L 2723 34333 L 2690 34112 L 2657 33898 L 2644 33829 L 2625 33719 L 2557 33265 L 2519 33025 L 2491 32832 L 2467 32716 L 2462 32683 L 2425 32458 L 2407 32332 L 2401 32300 L 2399 32282 L 2365 32082 L 2364 32075 L 2329 31879 L 2328 31872 L 2313 31763 L 2313 31763 L 2304 31689 L 2301 31670 L 2295 31628 L 2294 31621 L 2290 31595 L 2290 31595 L 2289 31589 L 2289 31589 L 2291 31602 L 2291 31602 L 2299 31648 L 2303 31672 L 2305 31689 L 2313 31763 L 2318 31798 L 2329 31879 L 2336 31932 L 2347 32008 L 2355 32064 L 2380 32246 L 2389 32324 L 2395 32358 L 2402 32438 L 2428 32606 L 2446 32725 L 2458 32815 L 2475 33008 L 2476 33022 L 2496 33171 L 2521 33404 L 2531 33480 L 2553 33722 L 2565 33818 L 2587 34064 L 2599 34158 L 2615 34291 L 2657 34640 L 2658 34654 L 2679 34834 L 2687 34896 L 2700 35003 L 2717 35129 L 2737 35304 L 2741 35336 L 2747 35382 L 2749 35398 L 2754 35443 L 2747 35382 L 2728 35241 L 2711 35108 L 2689 34982 L 2684 34948 L 2651 34735 L 2592 34355 L 2585 34298 L 2553 34062 L 2536 33888 L 2494 33584 L 2475 33450 L 2389 32842 L 2385 32816 L 2296 32087 L 2283 31968 L 2249 31734 L 2203 31394 L 2153 31049 L 2136 30899 L 2104 30674 L 2097 30623 L 2034 30175 L 2027 30125 L 1998 29894 L 1977 29743 L 1970 29599 L 1949 29453 L 1927 29407 L 1904 29291 L 1895 29230 L 1887 29169 L 1868 29031 L 1868 29031 L 1857 28970 L 1855 28953 L 1849 28916 L 1836 28854 L 1834 28837 L 1818 28718 L 1817 28705 L 1780 28447 L 1776 28421 L 1772 28395 L 1767 28364 L 1766 28357 L 1761 28322 L 1752 28267 L 1747 28236 L 1743 28207 L 1743 28207 L 1738 28171 L 1732 28126 L 1726 28085 L 1726 28085 L 1715 28011 L 1714 28004 L 1709 27967 L 1709 27967 L 1704 27934 L 1703 27927 L 1699 27899 L 1694 27865 L 1691 27845 L 1685 27805 L 1684 27798 L 1679 27766 L 1677 27752 L 1664 27654 L 1663 27647 L 1656 27599 L 1653 27578 L 1648 27547 L 1643 27516 L 1640 27495 L 1635 27460 L 1633 27447 L 1630 27427 L 1617 27335 L 1617 27335 L 1604 27246 L 1603 27239 L 1591 27162 L 1590 27155 L 1578 27087 L 1576 27073 L 1571 27044 L 1569 27030 L 1563 26994 L 1560 26974 L 1557 26953 L 1546 26872 L 1541 26840 L 1531 26770 L 1527 26743 L 1522 26709 L 1519 26689 L 1518 26682 L 1518 26682 L 1520 26696 L 1526 26746 L 1534 26805 L 1538 26841 L 1547 26904 L 1559 27000 L 1568 27072 L 1607 27413 L 1615 27928 L 1686 28904 L 1728 29256 L 1781 29678 L 1784 29723 L 1802 29916 L 1880 30746 L 1919 31172 L 2038 32384 L 2042 32447 L 2118 33328 L 2121 33383 L 2238 34806 L 2243 34903 L 2340 36116 L 2357 36418 L 2524 38844 L 2527 38930 L 2615 40406 L 2669 41248 L 2815 43459 L 2833 43813 L 2891 44860 L 2919 45353 L 2983 46503 L 3017 47115 L 3091 48423 L 3118 48933 L 3182 50077 L 3239 51123 L 3263 51574 L 3285 51977 L 3317 52575 L 3324 52725 L 3372 53718 L 3384 53962 L 3673 59668 L 3702 60277 L 3751 61173 L 3791 61893 L 3811 62270 L 3883 63618 L 3926 64454 L 3985 65616 L 4067 67404 L 4108 68181 L 4187 69817 L 4293 71687 L 4312 72067 L 4416 74154 L 4422 74282 L 4541 76585 L 4656 78887 L 4676 79337 L 4787 81584 L 4795 81782 L 5013 85763 L 5095 87368 L 5124 87934 L 5210 89486 L 5260 90491 L 5444 93982 L 5549 95960 L 5601 96896 L 5641 97640 L 5668 98148 L 5771 100000 L 5818 101147 L 5985 104171 L 6004 104437 L 6066 105580 L 6130 106594 L 6225 108453 L 6311 110073 L 6358 111131 L 6388 111871 L 6478 113689 L 6481 113756 L 6557 115310 L 6559 115367 L 6596 116067 L 6630 116627 L 6647 116964 L 6658 117182 L 6663 117282 L 6663 117282 L 6666 117334 L 6657 117186 L 6653 117116 L 6638 116872 L 6618 116548 L 6604 116304 L 6551 115375 L 6543 115235 L 6494 114417 L 6468 114031 L 6453 113746 L 6404 112951 L 6395 112806 L 6331 111762 L 6297 111233 L 6282 110968 L 6162 109029 L 6134 108594 L 6051 107417 L 6005 106613 L 5989 106356 L 5946 105751 L 5898 104996 L 5844 104182 L 5727 102367 L 5704 102019 L 5670 101528 L 5668 101497 L 5577 100058 L 5517 99098 L 5428 97673 L 5414 97460 L 5345 96396 L 5254 94871 L 5193 93883 L 5167 93455 L 5083 92124 L 5067 91877 L 4977 90523 L 4852 88567 L 4835 88282 L 4753 87047 L 4702 86184 L 4514 83411 L 4506 83284 L 4407 81668 L 4373 81092 L 4227 78693 L 4220 78560 L 4153 77440 L 3900 73473 L 3882 73125 L 3743 70585 L 3656 69106 L 3618 68442 L 3552 67323 L 3450 65680 L 3427 65251 L 3303 63329 L 3209 61891 L 3155 60972 L 3102 59994 L 3041 59042 L 2964 57737 L 2780 55006 L 2740 54272 L 2613 52219 L 2580 51642 L 2493 50234 L 2432 49320 L 2400 48783 L 2216 46156 L 2180 45582 L 2107 44706 L 1944 42238 L 1936 42082 L 1750 38598 L 1725 38168 L 1525 35125 L 1423 33476 L 1381 32497 L 1292 30961 L 1258 30053 L 1172 28619 L 1079 27174 L 1002 25798 L 920 24542 L 725 22014 L 689 21433 L 614 20311 L 550 19296 L 447 17733 L 422 17330 L 371 16572 L 288 15356 L 225 14368 L 203 14046 L 57 11731 L 12 10938 L -13 10571 L -51 9991 L -77 9624 L -132 9022 L -148 8841 L -190 8343 L -199 8232 L -277 7340 L -280 7291 L -319 6852 L -331 6710 L -362 6349 L -387 6069 L -399 5927 L -422 5665 L -452 5334 L -460 5238 L -487 4933 L -488 4923 L -515 4622 L -533 4422 L -549 4248 L -558 4147 L -562 4100 L -563 4091 L -570 4014 L -574 3971 L -577 3938 L -577 3938 L -576 3941 L -576 3941 L -571 3980 L -567 4013 L -563 4047 L -563 4047 L -556 4101 L -555 4108 L -545 4193 L -543 4212 L -534 4288 L -526 4359 L -522 4395 L -521 4407 L -516 4449 L -516 4449 L -510 4500 L -510 4500 L -504 4548 L -503 4557 L -498 4597 L -498 4597 L -490 4667 L -490 4667 L -486 4702 L -484 4734 L -476 4805 L -470 4859 L -468 4877 L -467 4921 L -462 4968 L -459 4993 L -452 5055 L -451 5064 L -449 5082 L -449 5082 L -445 5118 L -441 5154 L -440 5182 L -436 5212 L -433 5241 L -432 5268 L -429 5295 L -427 5328 L -421 5383 L -420 5398 L -412 5473 L -408 5508 L -404 5544 L -404 5544 L -397 5609 L -397 5609 L -392 5651 L -387 5698 L -385 5717 L -383 5736 L -382 5746 L -375 1344 Z`;
        
        // Initialize
        let telemetryData = null;
        let currentDriver = null;
        let compareMode = false;
        
        // Load track paths
        document.getElementById('trackBase').setAttribute('d', trackPath);
        document.getElementById('racingLine').setAttribute('d', trackPath);
        
        // Load telemetry data
        async function loadTelemetry() {
            try {
                const response = await fetch('telemetry_data.json');
                telemetryData = await response.json();
                console.log('Data loaded:', Object.keys(telemetryData.drivers));
                renderDriverList();
                selectDriver(Object.keys(telemetryData.drivers)[0]);
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }
        
        // Render driver list
        function renderDriverList() {
            const list = document.getElementById('driverList');
            const drivers = Object.values(telemetryData.drivers).sort((a, b) => 
                a.lap.lap_time_sec - b.lap.lap_time_sec
            );
            
            list.innerHTML = drivers.map(d => `
                <button class="driver-btn" onclick="selectDriver('${d.lap.driver}')">
                    <div class="name">${d.lap.driver}</div>
                    <div class="time">${formatTime(d.lap.lap_time_sec)}</div>
                    <div style="color:#888;font-size:10px">${d.lap.team}</div>
                </button>
            `).join('');
        }
        
        // Select driver
        function selectDriver(driverId) {
            currentDriver = driverId;
            const data = telemetryData.drivers[driverId];
            if (!data) return;
            
            // Update info
            document.getElementById('driverName').textContent = data.lap.driver;
            document.getElementById('driverTeam').textContent = data.lap.team;
            document.getElementById('lapTime').textContent = formatTime(data.lap.lap_time_sec);
            document.getElementById('driverCompound').textContent = data.lap.compound || 'N/A';
            
            // Sectors
            document.getElementById('sector1').textContent = data.lap.sector1 ? formatSector(data.lap.sector1) : 'N/A';
            document.getElementById('sector2').textContent = data.lap.sector2 ? formatSector(data.lap.sector2) : 'N/A';
            document.getElementById('sector3').textContent = data.lap.sector3 ? formatSector(data.lap.sector3) : 'N/A';
            
            // Telemetry path
            const path = data.telemetry.map(t => `${t.x} ${t.y}`).join(' L ');
            document.getElementById('telemetryPath').setAttribute('d', `M ${path}`);
            
            // Micro sectors
            renderMicroSectors(data.sectors);
            
            // Charts
            renderCharts(data.telemetry);
            
            // Highlight driver in list
            document.querySelectorAll('.driver-btn').forEach(btn => {
                btn.classList.toggle('active', btn.querySelector('.name').textContent === driverId);
            });
        }
        
        // Render micro sectors
        function renderMicroSectors(sectors) {
            const container = document.getElementById('microSectors');
            const speeds = sectors.map(s => s.avg_speed);
            const maxSpeed = Math.max(...speeds);
            const minSpeed = Math.min(...speeds);
            const avgSpeed = speeds.reduce((a, b) => a + b, 0) / speeds.length;
            
            container.innerHTML = sectors.map((s, i) => {
                let cls = 'normal';
                if (s.avg_speed >= maxSpeed * 0.98) cls = 'best';
                else if (s.avg_speed >= avgSpeed * 1.05) cls = 'fast';
                else if (s.avg_speed <= avgSpeed * 0.9) cls = 'slow';
                
                return `<div class="micro-sector ${cls}" title="Setor ${i+1}: ${s.avg_speed.toFixed(0)} km/h">${s.avg_speed.toFixed(0)}</div>`;
            }).join('');
        }
        
        // Render charts
        function renderCharts(telemetry) {
            // Speed chart
            drawChart('speedChart', telemetry.map(t => t.speed), '#00f0ff', 350);
            document.getElementById('speedValue').textContent = `${Math.max(...telemetry.map(t => t.speed)).toFixed(0)} km/h`;
            
            // RPM chart
            drawChart('rpmChart', telemetry.map(t => t.rpm), '#ff00aa', 15000);
            document.getElementById('rpmValue').textContent = Math.max(...telemetry.map(t => t.rpm)).toFixed(0);
            
            // Throttle/Brake chart
            const throttleData = telemetry.map(t => ({
                throttle: t.throttle,
                brake: t.brake ? 100 : 0
            }));
            drawDualChart('throttleChart', throttleData);
        }
        
        function drawChart(canvasId, data, color, max) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = rect.height * 2;
            ctx.scale(2, 2);
            
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // Draw fill
            ctx.beginPath();
            ctx.moveTo(0, height);
            data.forEach((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - (val / max) * height;
                ctx.lineTo(x, y);
            });
            ctx.lineTo(width, height);
            ctx.fillStyle = color + '20';
            ctx.fill();
            
            // Draw line
            ctx.beginPath();
            data.forEach((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - (val / max) * height;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
        }
        
        function drawDualChart(canvasId, data) {
            const canvas = document.getElementById(canvasId);
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * 2;
            canvas.height = rect.height * 2;
            ctx.scale(2, 2);
            
            const width = rect.width;
            const height = rect.height;
            
            ctx.clearRect(0, 0, width, height);
            
            // Throttle
            ctx.beginPath();
            data.forEach((d, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - (d.throttle / 100) * height;
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            ctx.stroke();
            
            // Brake (as red markers)
            data.forEach((d, i) => {
                if (d.brake > 0) {
                    const x = (i / (data.length - 1)) * width;
                    ctx.fillStyle = '#ff4444';
                    ctx.fillRect(x - 2, 0, 4, height);
                }
            });
        }
        
        // Format time
        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = Math.floor(seconds % 60);
            const ms = Math.floor((seconds % 1) * 1000);
            return `${m}:${s.toString().padStart(2, '0')}.${ms.toString().padStart(3, '0')}`;
        }
        
        function formatSector(timeStr) {
            if (!timeStr || timeStr === 'NaN') return 'N/A';
            const match = timeStr.match(/0 days 00:(\d+)\.(\d+)/);
            if (match) {
                return `${match[1]}.${match[2].padEnd(3, '0').slice(0,3)}`;
            }
            return timeStr;
        }
        
        // Load on start
        loadTelemetry();
        
        // Compare button
        document.getElementById('compareBtn').addEventListener('click', () => {
            compareMode = !compareMode;
            document.getElementById('compareBtn').classList.toggle('active', compareMode);
            document.getElementById('compareBtn').textContent = compareMode ? 'Comparing...' : 'Compare';
        });
    </script>
</body>
</html>
